{"ast":null,"code":"import _classCallCheck from \"/Users/PhilipChoi/Desktop/milimili/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/PhilipChoi/Desktop/milimili/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/PhilipChoi/Desktop/milimili/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/PhilipChoi/Desktop/milimili/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/PhilipChoi/Desktop/milimili/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/PhilipChoi/Desktop/milimili/src/App.js\";\nimport React, { Component } from 'react';\nimport 'react-notifications/lib/notifications.css';\nimport './App.css';\nimport './App.scss';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { Navbar, NavItem, Nav } from 'reactstrap';\nimport { HashRouter, Route, Switch, Link, Redirect } from 'react-router-dom';\nimport { TagCloud } from \"react-tagcloud\";\nimport _ from 'lodash';\nimport firebase from 'firebase/app';\nimport 'firebase/database';\nimport SignUpForm from './SignUpForm';\nimport ChosenDiary from './ChosenDiary';\nimport SavedDiaries from './SavedDiaries';\nimport WriteDiary from './WriteDiary';\nimport OthersDiaries from './OthersDiaries';\nimport { NotificationContainer, NotificationManager } from 'react-notifications';\nimport '@firebase/messaging'; // import { forEach } from '@firebase/util';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _this.notifyUser = function (comment, diary) {\n      var ref = firebase.database().ref(\"diaries/\".concat(diary.userID));\n      var newData = {\n        commenterID: comment.userID,\n        writerID: diary.userID,\n        commentText: comment.text,\n        diaryKey: diary.key,\n        title: diary.value\n      };\n      ref.child('notification').child(diary.key).push(newData);\n      ref.child('notification').on(\"value\", function (snapshot) {\n        console.log(\"commented!:\");\n        console.log(snapshot.val());\n      });\n    };\n\n    _this.textUpdate = function (diary, date, title) {\n      console.log(_this.state.user);\n      var currentUser = _this.state.user;\n      var newData = {\n        userID: currentUser.uid,\n        time: firebase.database.ServerValue.TIMESTAMP,\n        diary: diary,\n        title: title,\n        date: date,\n        displayName: currentUser.displayName,\n        shared: false // copiedDiaries.push(newData);\n\n      };\n      var diariesRef = firebase.database().ref(\"diaries/\".concat(currentUser.uid));\n      console.log(newData);\n      diariesRef.push(newData);\n    };\n\n    _this.shareDiary = function (diary) {\n      console.log(diary);\n      var ref = firebase.database().ref(\"diaries/\".concat(_this.state.user.uid));\n      var shared = false;\n      firebase.database().ref('shared/diaries').on(\"value\", function (snapshot) {\n        // if shared diary exists already\n        for (var key in snapshot.val()) {\n          if (diary.key === key) {\n            shared = true;\n            console.log('HEY!!!');\n          }\n        }\n      }); // console.log('HEY!!!')\n      // console.log(diary)\n      //title: diary.value\n\n      if (shared === false) {\n        firebase.database().ref(\"shared/diaries/\").child(diary.key).set(diary);\n        ref.child(diary.key).child(\"shared\").set(true); // shared = true;\n        // ref.child(diary.key).child(shared).set(true);\n      } else {\n        alert(\"이미 공유하신 게시물입니다!\");\n      }\n    };\n\n    _this.removeMySharedDiary = function (id) {\n      console.log(\"sharedremove:\");\n      console.log(id);\n      var ref = firebase.database().ref(\"shared/diaries\").child(id);\n      ref.remove(); // window.location.reload()\n      // this.setState({sharedDiaries})\n    };\n\n    _this.removeDiary = function (id) {\n      var diariesRef = firebase.database().ref(\"diaries/\".concat(_this.state.user.uid));\n      diariesRef.child(id).remove();\n    };\n\n    _this.clickUpdate = function (diary) {\n      console.log(diary); // console.log(diary.value)\n\n      _this.setState({\n        clickedDiary: diary\n      }); // console.log(this.state.clickedDiary.value)\n\n    };\n\n    _this.clickLogIn = function () {\n      _this.setState({\n        clickedLogIn: true\n      });\n    };\n\n    _this.state = {\n      diaries: [],\n      sharedDiaries: [],\n      clickedDiary: '',\n      clickedLogIn: false,\n      notification: []\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.authUnRegFunc = firebase.auth().onAuthStateChanged(function (firebaseUser) {\n        if (firebaseUser) {\n          _this2.setState({\n            user: firebaseUser\n          }); //setting state for my private diaries\n          // let messaging = firebase.messaging();\n          // messaging.usePublicVapidKey(\"AAAAydXUZE0:APA91bFX8qMLjnDWsSaNVE7JvoSl5FFmPWVSseYFilJoFCbRPN_PYRF4tYd1nmTBVO9kLkgUOOz3dQ1CHTo0EFGgnVLIPaKETfHcSbmenv8k_GWttpjoTVoF684HnSrmeiP3dqsQT_JD\");\n          // messaging.requestPermission()\n          //   .then(function () {\n          //     console.log(\"havePermission\")\n          //   })\n\n\n          firebase.database().ref(\"diaries/\".concat(_this2.state.user.uid)).on(\"value\", function (snapshot) {\n            // console.log(\"posted\");\n            // console.log(snapshot.val())\n            var diariesObject = [];\n\n            if (snapshot.exists()) {\n              var diariesKeys = Object.keys(snapshot.val()); // console.log(chirpsKeys);\n\n              console.log(snapshot.val());\n              diariesObject = diariesKeys.map(function (key) {\n                var diariesObj = {};\n\n                if (key !== 'notification') {\n                  diariesObj = snapshot.val()[key]; // console.log(key)\n\n                  diariesObj.id = key;\n                }\n\n                return diariesObj;\n              });\n            }\n\n            console.log(\"Component Did Mount:\");\n            console.log(diariesObject);\n\n            _this2.setState({\n              diaries: diariesObject\n            });\n          }); //setting state for my shared diaries\n\n          firebase.database().ref(\"shared/diaries\").on(\"value\", function (snapshot) {\n            var sharedObject = [];\n\n            if (snapshot.exists()) {\n              var sharedKeys = Object.keys(snapshot.val()); // console.log(chirpsKeys);\n\n              sharedObject = sharedKeys.map(function (key) {\n                var sharedObj = snapshot.val()[key];\n                sharedObj.id = key;\n                return sharedObj;\n              });\n\n              _this2.setState({\n                sharedDiaries: sharedObject\n              });\n            }\n          });\n          var notifyObject = [];\n          firebase.database().ref(\"diaries/\".concat(_this2.state.user.uid)).child('notification').on(\"value\", function (snapshot) {\n            if (snapshot.exists()) {\n              var notifyKeys = Object.keys(snapshot.val());\n              console.log(notifyKeys);\n              notifyObject = notifyKeys.map(function (key) {\n                var notifyObj = snapshot.val()[key];\n                notifyObj.id = key;\n                return notifyObj;\n              });\n            }\n\n            _this2.setState({\n              notification: notifyObject\n            });\n          });\n          console.log(notifyObject);\n        } else {\n          _this2.setState({\n            user: null\n          });\n        }\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.authUnRegFunc();\n    } // handleAnonymous(anonymous) {\n    //   console.log(\"anonymous:\")\n    //   console.log(anonymous)\n    //   this.setState({errorMessage:null})\n    //   if(anonymous){\n    //     firebase.auth().signInAnonymously().catch(function(error) {\n    //       this.setState({errorMessage: error.message})\n    //     });\n    //   }\n    // }\n\n  }, {\n    key: \"handleSignUp\",\n    value: function handleSignUp(email, password, handle) {\n      var _this3 = this;\n\n      var user = null;\n      this.setState({\n        errorMessage: null\n      });\n      firebase.auth().createUserWithEmailAndPassword(email, password).then(function () {\n        user = firebase.auth().currentUser;\n        user.sendEmailVerification();\n      }).then(function () {\n        user.updateProfile({\n          displayName: handle\n        });\n      }).catch(function (err) {\n        _this3.setState({\n          errorMessage: err.message\n        });\n      });\n      /* TODO: sign up user here */\n    }\n  }, {\n    key: \"handleSignIn\",\n    value: function handleSignIn(email, password) {\n      var _this4 = this;\n\n      // window.location.reload();\n      this.setState({\n        errorMessage: null\n      });\n      firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {\n        return _this4.setState({\n          errorMessage: error.message\n        });\n      });\n    } //A callback function for logging out the current user\n\n  }, {\n    key: \"handleSignOut\",\n    value: function handleSignOut() {\n      var _this5 = this;\n\n      this.setState({\n        errorMessage: null\n      }); //clear any old errors\n\n      window.location = '/';\n      firebase.auth().signOut().catch(function (error) {\n        _this5.setState({\n          errorMessage: error.message\n        });\n      });\n      /* TODO: sign out user here */\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var content = null; //content to render\n\n      if (!this.state.user) {\n        //if logged out, show signup form\n        content = React.createElement(\"div\", {\n          className: \"container \",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 252\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          id: \"websiteTitle\",\n          style: {\n            textAlign: 'center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 254\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 255\n          },\n          __self: this\n        }, \"M\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 256\n          },\n          __self: this\n        }, \"I\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 257\n          },\n          __self: this\n        }, \"L\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 258\n          },\n          __self: this\n        }, \"I\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 259\n          },\n          __self: this\n        }, \"M\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 260\n          },\n          __self: this\n        }, \"I\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 261\n          },\n          __self: this\n        }, \"L\"), React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 262\n          },\n          __self: this\n        }, \"I\")), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 264\n          },\n          __self: this\n        }), React.createElement(SignUpForm, {\n          signUpCallback: function signUpCallback(email, password, handle) {\n            return _this6.handleSignUp(email, password, handle);\n          },\n          signInCallback: function signInCallback(email, password) {\n            return _this6.handleSignIn(email, password);\n          } // handleAnonymous = {(anonymous) => this.handleAnonymous(anonymous)}\n          ,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 265\n          },\n          __self: this\n        }));\n      } else {\n        console.log(\"state Diaries:\");\n        console.log(this.state.diaries);\n        content = React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 276\n          },\n          __self: this\n        }, React.createElement(\"header\", {\n          className: \"App-header\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 277\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"menuBar mt-2 ml-2\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 278\n          },\n          __self: this\n        }, React.createElement(Notification, {\n          notification: this.state.notification,\n          currentUser: this.state.user,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 279\n          },\n          __self: this\n        }), this.state.user && React.createElement(\"button\", {\n          id: \"logOutButton\",\n          className: \"btn-lg btn\",\n          onClick: function onClick() {\n            return _this6.handleSignOut();\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 280\n          },\n          __self: this\n        }, React.createElement(\"i\", {\n          class: \"fas fa-sign-out-alt\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 281\n          },\n          __self: this\n        }))), React.createElement(\"h1\", {\n          className: \"text-center\",\n          id: \"title\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 284\n          },\n          __self: this\n        }, React.createElement(Link, {\n          to: \"/\",\n          id: \"titleLink\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 284\n          },\n          __self: this\n        }, \"MiliMili\")), React.createElement(\"div\", {\n          className: \"text-center\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 288\n          },\n          __self: this\n        })), React.createElement(\"main\", {\n          className: \"navBar mt-3\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 298\n          },\n          __self: this\n        }, React.createElement(HashRouter, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 299\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 300\n          },\n          __self: this\n        }, React.createElement(Navbar, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 301\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"mx-auto\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 302\n          },\n          __self: this\n        }, React.createElement(Nav, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 303\n          },\n          __self: this\n        }, React.createElement(NavItem, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 304\n          },\n          __self: this\n        }, React.createElement(Link, {\n          to: '/',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 304\n          },\n          __self: this\n        }, \"\\uC77C\\uAE30\\uC4F0\\uAE30\")), React.createElement(NavItem, {\n          className: \"ml-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 306\n          },\n          __self: this\n        }, React.createElement(Link, {\n          to: '/SavedDiaries',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 306\n          },\n          __self: this\n        }, \"\\uB098\\uC758 \\uC77C\\uAE30 \")), React.createElement(NavItem, {\n          className: \"ml-5\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308\n          },\n          __self: this\n        }, React.createElement(Link, {\n          to: '/others',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 308\n          },\n          __self: this\n        }, \"\\uACF5\\uC720\\uB41C \\uC77C\\uAE30\"))))), React.createElement(Switch, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 312\n          },\n          __self: this\n        }, React.createElement(Route, {\n          exact: true,\n          path: \"/\",\n          render: function render() {\n            return React.createElement(WriteDiary, {\n              textUpdate: _this6.textUpdate,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 313\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 313\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/SavedDiaries\",\n          render: function render() {\n            return React.createElement(SavedDiaries, {\n              diaries: _this6.state.diaries,\n              clickUpdate: _this6.clickUpdate,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 315\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 315\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/others\",\n          render: function render() {\n            return React.createElement(OthersDiaries, {\n              clickUpdate: _this6.clickUpdate,\n              sharedDiaries: _this6.state.sharedDiaries,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 316\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 316\n          },\n          __self: this\n        }), React.createElement(Route, {\n          path: \"/ChosenDiary/:keySeconds\",\n          render: function render() {\n            return React.createElement(ChosenDiary, {\n              diary: _this6.state.clickedDiary,\n              currentUser: _this6.state.user,\n              removeDiary: _this6.removeDiary,\n              shareDiary: _this6.shareDiary,\n              removeMySharedDiary: _this6.removeMySharedDiary,\n              notifyUser: _this6.notifyUser,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 317\n              },\n              __self: this\n            });\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 317\n          },\n          __self: this\n        }), React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 320\n          },\n          __self: this\n        }))))));\n      }\n\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 331\n        },\n        __self: this\n      }, this.state.errorMessage && React.createElement(\"p\", {\n        className: \"alert alert-danger\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333\n        },\n        __self: this\n      }, this.state.errorMessage), content);\n    }\n  }]);\n\n  return App;\n}(Component);\n\nvar Notification =\n/*#__PURE__*/\nfunction (_Component2) {\n  _inherits(Notification, _Component2);\n\n  function Notification(props) {\n    var _this7;\n\n    _classCallCheck(this, Notification);\n\n    _this7 = _possibleConstructorReturn(this, _getPrototypeOf(Notification).call(this, props));\n\n    _this7.handleNotification = function () {\n      console.log(\"Clicked\");\n\n      for (var i = 0; i < _this7.props.notification.length; i++) {\n        _this7.createNotification(_this7.props.notification[i]);\n      }\n    };\n\n    _this7.state = {\n      notification: []\n    };\n    return _this7;\n  }\n\n  _createClass(Notification, [{\n    key: \"clickedNotification\",\n    value: function clickedNotification(parameter) {\n      return React.createElement(Redirect, {\n        push: true,\n        to: '/ChosenDiary/' + parameter,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 358\n        },\n        __self: this\n      });\n    }\n  }, {\n    key: \"createNotification\",\n    value: function createNotification(notification) {\n      var _this8 = this;\n\n      console.log(\"clicked\");\n      console.log(notification);\n\n      if (_.size(notification) > 1) {\n        // eslint-disable-next-line default-case\n        NotificationManager.info(\"\\\"\".concat(notification[Object.keys(notification)[0]].title, \"\\\"\"), \"\".concat(_.size(notification), \"\\uAC1C\\uC758 \\uB313\\uAE00\\uC774 \\uB2EC\\uB838\\uC2B5\\uB2C8\\uB2E4!\"), 3000, function () {\n          return _this8.clickedNotification(notification[Object.keys(notification)[0]]).diaryKey;\n        });\n      } else {\n        NotificationManager.info(\"\\uB313\\uAE00\\uC774 \\uB2EC\\uB838\\uC2B5\\uB2C8\\uB2E4!\");\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      console.log(\"Notification Object:\");\n      console.log(this.props.notification);\n      return React.createElement(\"div\", {\n        className: \"containerNotification\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 376\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"ml-2 mt-2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 377\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        id: \"notifyButton\",\n        style: {\n          borderRadius: 200\n        },\n        className: \"btn-lg btn\",\n        onClick: this.handleNotification,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 378\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"fas fa-comment\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379\n        },\n        __self: this\n      }, \" \", React.createElement(\"span\", {\n        id: \"num\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379\n        },\n        __self: this\n      }, this.props.notification.length), \" \")), React.createElement(NotificationContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 394\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Notification;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/PhilipChoi/Desktop/milimili/src/App.js"],"names":["React","Component","Navbar","NavItem","Nav","HashRouter","Route","Switch","Link","Redirect","TagCloud","_","firebase","SignUpForm","ChosenDiary","SavedDiaries","WriteDiary","OthersDiaries","NotificationContainer","NotificationManager","App","props","notifyUser","comment","diary","ref","database","userID","newData","commenterID","writerID","commentText","text","diaryKey","key","title","value","child","push","on","snapshot","console","log","val","textUpdate","date","state","user","currentUser","uid","time","ServerValue","TIMESTAMP","displayName","shared","diariesRef","shareDiary","set","alert","removeMySharedDiary","id","remove","removeDiary","clickUpdate","setState","clickedDiary","clickLogIn","clickedLogIn","diaries","sharedDiaries","notification","authUnRegFunc","auth","onAuthStateChanged","firebaseUser","diariesObject","exists","diariesKeys","Object","keys","map","diariesObj","sharedObject","sharedKeys","sharedObj","notifyObject","notifyKeys","notifyObj","email","password","handle","errorMessage","createUserWithEmailAndPassword","then","sendEmailVerification","updateProfile","catch","err","message","signInWithEmailAndPassword","error","window","location","signOut","content","textAlign","handleSignUp","handleSignIn","handleSignOut","Notification","handleNotification","i","length","createNotification","parameter","size","info","clickedNotification","borderRadius"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport 'react-notifications/lib/notifications.css';\nimport './App.css';\nimport './App.scss'\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { Navbar, NavItem, Nav } from 'reactstrap'\nimport { HashRouter, Route, Switch, Link, Redirect } from 'react-router-dom';\nimport { TagCloud } from \"react-tagcloud\";\nimport _ from 'lodash';\nimport firebase from 'firebase/app';\nimport 'firebase/database';\nimport SignUpForm from './SignUpForm';\nimport ChosenDiary from './ChosenDiary'\nimport SavedDiaries from './SavedDiaries'\nimport WriteDiary from './WriteDiary'\nimport OthersDiaries from './OthersDiaries'\nimport { NotificationContainer, NotificationManager } from 'react-notifications';\nimport '@firebase/messaging'\n\n// import { forEach } from '@firebase/util';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      diaries: [],\n      sharedDiaries: [],\n      clickedDiary: '',\n      clickedLogIn: false,\n      notification: []\n    }\n  }\n\n  notifyUser = (comment, diary) => {\n    let ref = firebase.database().ref(`diaries/${diary.userID}`)\n    let newData = {\n      commenterID: comment.userID, writerID: diary.userID, commentText: comment.text, diaryKey: diary.key, title:diary.value\n    }\n    ref.child('notification').child(diary.key).push(newData)\n    ref.child('notification').on(\"value\", (snapshot) => {\n      console.log(\"commented!:\")\n      console.log(snapshot.val())\n    })\n\n  }\n\n  textUpdate = (diary, date, title) => {\n    console.log(this.state.user)\n    let currentUser = this.state.user;\n    let newData = {\n      userID: currentUser.uid,\n      time: firebase.database.ServerValue.TIMESTAMP, diary: diary,\n      title: title, date: date, displayName: currentUser.displayName,\n      shared: false\n    }\n    // copiedDiaries.push(newData);\n    let diariesRef = firebase.database().ref(`diaries/${currentUser.uid}`)\n    console.log(newData);\n    diariesRef.push(newData);\n  }\n\n  shareDiary = (diary) => {\n    console.log(diary)\n    let ref = firebase.database().ref(`diaries/${this.state.user.uid}`)\n    let shared = false\n\n    firebase.database().ref('shared/diaries').on(\"value\", (snapshot) => {\n      // if shared diary exists already\n      for (let key in snapshot.val()) {\n        if (diary.key === key) {\n          shared = true;\n          console.log('HEY!!!')\n        }\n      }\n    })\n    // console.log('HEY!!!')\n    // console.log(diary)\n    //title: diary.value\n    if (shared === false) {\n      firebase.database().ref(`shared/diaries/`).child(diary.key).set(diary)\n      ref.child(diary.key).child(`shared`).set(true);\n      // shared = true;\n      // ref.child(diary.key).child(shared).set(true);\n    } else {\n      alert(\"이미 공유하신 게시물입니다!\")\n    }\n  }\n\n  removeMySharedDiary = (id) => {\n    console.log(\"sharedremove:\")\n    console.log(id)\n    let ref = firebase.database().ref(`shared/diaries`).child(id)\n    ref.remove()\n    // window.location.reload()\n    // this.setState({sharedDiaries})\n  }\n\n  removeDiary = (id) => {\n    let diariesRef = firebase.database().ref(`diaries/${this.state.user.uid}`)\n    diariesRef.child(id).remove();\n  }\n\n  clickUpdate = (diary) => {\n    console.log(diary)\n    // console.log(diary.value)\n    this.setState({ clickedDiary: diary })\n    // console.log(this.state.clickedDiary.value)\n  }\n  clickLogIn = () => {\n    this.setState({ clickedLogIn: true })\n  }\n\n  componentDidMount() {\n    this.authUnRegFunc = firebase.auth().onAuthStateChanged((firebaseUser) => {\n      if (firebaseUser) {\n        this.setState({\n          user: firebaseUser,\n        })\n        //setting state for my private diaries\n        // let messaging = firebase.messaging();\n        // messaging.usePublicVapidKey(\"AAAAydXUZE0:APA91bFX8qMLjnDWsSaNVE7JvoSl5FFmPWVSseYFilJoFCbRPN_PYRF4tYd1nmTBVO9kLkgUOOz3dQ1CHTo0EFGgnVLIPaKETfHcSbmenv8k_GWttpjoTVoF684HnSrmeiP3dqsQT_JD\");\n        // messaging.requestPermission()\n        //   .then(function () {\n        //     console.log(\"havePermission\")\n        //   })\n\n\n        firebase.database().ref(`diaries/${this.state.user.uid}`).on(\"value\", (snapshot) => {\n          // console.log(\"posted\");\n          // console.log(snapshot.val())\n          let diariesObject = [];\n          if (snapshot.exists()) {\n            let diariesKeys = Object.keys(snapshot.val())\n            // console.log(chirpsKeys);\n            console.log(snapshot.val())\n            \n            diariesObject = diariesKeys.map((key) => {\n              let diariesObj={}\n              if(key!== 'notification'){\n              diariesObj = snapshot.val()[key];\n              // console.log(key)\n              diariesObj.id = key;\n              }\n              return diariesObj;\n            })\n          }\n\n          console.log(\"Component Did Mount:\")\n          console.log(diariesObject)\n          this.setState({ diaries: diariesObject })\n\n        })\n        //setting state for my shared diaries\n\n\n        firebase.database().ref(`shared/diaries`).on(\"value\", (snapshot) => {\n          let sharedObject = [];\n          if (snapshot.exists()) {\n            let sharedKeys = Object.keys(snapshot.val())\n            // console.log(chirpsKeys);\n            sharedObject = sharedKeys.map((key) => {\n              let sharedObj = snapshot.val()[key];\n              sharedObj.id = key;\n              return sharedObj;\n            })\n            this.setState({ sharedDiaries: sharedObject })\n          }\n        })\n\n        let notifyObject = [];\n        firebase.database().ref(`diaries/${this.state.user.uid}`).child('notification').on(\"value\",(snapshot)=>{\n          if(snapshot.exists()){\n          let notifyKeys = Object.keys(snapshot.val())\n          console.log(notifyKeys)\n          notifyObject = notifyKeys.map((key) => {\n            let notifyObj = snapshot.val()[key];\n            notifyObj.id = key;\n            return notifyObj;\n          })\n        }\n          this.setState({notification: notifyObject})\n        })\n        console.log(notifyObject)\n\n      } else {\n        this.setState({ user: null })\n      }\n    })\n  }\n\n  componentWillUnmount() {\n    this.authUnRegFunc();\n  }\n\n  // handleAnonymous(anonymous) {\n  //   console.log(\"anonymous:\")\n  //   console.log(anonymous)\n  //   this.setState({errorMessage:null})\n  //   if(anonymous){\n  //     firebase.auth().signInAnonymously().catch(function(error) {\n  //       this.setState({errorMessage: error.message})\n  //     });\n  //   }\n  // }\n\n  handleSignUp(email, password, handle) {\n\n    let user = null;\n    this.setState({ errorMessage: null });\n    firebase.auth().createUserWithEmailAndPassword(email, password)\n      .then(function () {\n        user = firebase.auth().currentUser;\n        user.sendEmailVerification();\n      })\n      .then(function () {\n        user.updateProfile({\n          displayName: handle,\n        });\n      })\n      .catch((err) => {\n        this.setState({ errorMessage: err.message });\n      })\n\n\n    /* TODO: sign up user here */\n  }\n\n  handleSignIn(email, password) {\n    // window.location.reload();\n    this.setState({ errorMessage: null });\n    firebase.auth().signInWithEmailAndPassword(email, password)\n      .catch(error => this.setState({ errorMessage: error.message })\n      );\n  }\n\n  //A callback function for logging out the current user\n  handleSignOut() {\n    this.setState({ errorMessage: null }); //clear any old errors\n    window.location = '/';\n    firebase.auth().signOut()\n      .catch(error => {\n        this.setState({ errorMessage: error.message })\n      })\n    /* TODO: sign out user here */\n  }\n\n\n  render() {\n    let content = null; //content to render\n    if (!this.state.user) { //if logged out, show signup form\n      content = (\n        <div className=\"container \">\n          {/* 6F6B29 */}\n          <div id=\"websiteTitle\" style={{ textAlign: 'center' }}>\n            <span>M</span>\n            <span>I</span>\n            <span>L</span>\n            <span>I</span>\n            <span>M</span>\n            <span>I</span>\n            <span>L</span>\n            <span>I</span>\n          </div>\n          <br />\n          <SignUpForm\n            signUpCallback={(email, password, handle) => this.handleSignUp(email, password, handle)}\n            signInCallback={(email, password) => this.handleSignIn(email, password)}\n          // handleAnonymous = {(anonymous) => this.handleAnonymous(anonymous)}\n          />\n        </div>\n      );\n    } else {\n      console.log(\"state Diaries:\")\n      console.log(this.state.diaries)\n      content = (\n        <div>\n          <header className=\"App-header\">\n            <div className=\"menuBar mt-2 ml-2\">\n              <Notification notification={this.state.notification}  currentUser={this.state.user}/>\n              {this.state.user && <button id=\"logOutButton\" className=\"btn-lg btn\" onClick={() => this.handleSignOut()}>\n                <i class=\"fas fa-sign-out-alt\"></i>\n              </button>}\n            </div>\n            <h1 className=\"text-center\" id=\"title\"><Link to=\"/\" id=\"titleLink\">\n              MiliMili\n            </Link>\n            </h1>\n            <div className=\"text-center\">\n              {/* <button className=\"btn ml\" onClick={this.clickLogIn}>\n                  로그인\n            </button> */}\n              {/* {this.state.user && <button className=\"btn\" onClick={() => this.handleSignOut()}>\n                로그아웃\n            </button>} */}\n            </div>\n          </header>\n\n          <main className=\"navBar mt-3\">\n            <HashRouter>\n              <div>\n                <Navbar>\n                  <div className=\"mx-auto\">\n                    <Nav>\n                      <NavItem><Link to={'/'}>일기쓰기</Link>\n                      </NavItem>\n                      <NavItem className=\"ml-5\"><Link to={'/SavedDiaries'}>나의 일기 </Link>\n                      </NavItem>\n                      <NavItem className=\"ml-5\"><Link to={'/others'}>공유된 일기</Link></NavItem>\n                    </Nav>\n                  </div>\n                </Navbar>\n                <Switch>\n                  <Route exact path='/' render={() => <WriteDiary textUpdate={this.textUpdate}/>} />\n                  {/* <IndexRoute render={() => <SavedDiaries diaries={this.state.diaries} clickUpdate={this.clickUpdate} />}/> */}\n                  <Route path='/SavedDiaries' render={() => <SavedDiaries diaries={this.state.diaries} clickUpdate={this.clickUpdate} />} />\n                  <Route path='/others' render={() => <OthersDiaries clickUpdate={this.clickUpdate} sharedDiaries={this.state.sharedDiaries} />} />\n                  <Route path='/ChosenDiary/:keySeconds' render={() => <ChosenDiary diary={this.state.clickedDiary} currentUser={this.state.user}\n                    removeDiary={this.removeDiary} shareDiary={this.shareDiary} removeMySharedDiary={this.removeMySharedDiary}\n                    notifyUser={this.notifyUser} />} />\n                  <Redirect to='/' />\n                </Switch>\n              </div>\n            </HashRouter>\n          </main>\n        </div>\n\n      );\n\n    }\n    return (\n      <div className=\"App\">\n        {this.state.errorMessage &&\n          <p className=\"alert alert-danger\">{this.state.errorMessage}</p>\n        }\n        {content}\n\n      </div>\n\n    );\n  }\n}\n\n\nclass Notification extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      notification: []\n    }\n  }\n  handleNotification = () => {\n    console.log(\"Clicked\")\n    for(let i = 0; i<this.props.notification.length; i++){\n      this.createNotification(this.props.notification[i])\n    }\n  }\n  clickedNotification(parameter){\n    return <Redirect push to={'/ChosenDiary/' + parameter}/>\n  }\n  createNotification(notification) {\n    console.log(\"clicked\")\n    console.log(notification)\n    if( _.size(notification) > 1){ \n      // eslint-disable-next-line default-case\n      NotificationManager.info(`\"${notification[Object.keys(notification)[0]].title}\"`,`${_.size(notification) }개의 댓글이 달렸습니다!`, 3000,\n      ()=>{ return this.clickedNotification(notification[Object.keys(notification)[0]]).diaryKey});\n    }else{\n      NotificationManager.info(`댓글이 달렸습니다!`);\n    }\n  };\n\n  render() {\n      console.log(\"Notification Object:\")\n      console.log(this.props.notification)\n    return (\n      <div className=\"containerNotification\">\n        <div className=\"ml-2 mt-2\" >\n          <button id=\"notifyButton\" style={{ borderRadius: 200 }} className='btn-lg btn'\n            onClick={this.handleNotification}><i className=\"fas fa-comment\"> <span id=\"num\">{this.props.notification.length}</span> </i>\n          </button>\n          {/* <hr/> */}\n          {/* <button className='btn btn-success'\n          onClick={this.createNotification('success')}>Success\n        </button>\n        <hr/>\n        <button className='btn btn-warning'\n          onClick={this.createNotification('warning')}>Warning\n        </button>\n        <hr/>\n        <button className='btn btn-danger'\n          onClick={this.createNotification('error')}>Error\n        </button> */}\n\n          <NotificationContainer />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}